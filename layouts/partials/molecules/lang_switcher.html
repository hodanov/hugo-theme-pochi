{{/* Dropdown select-based language switcher */}}
{{ $current := . }}
{{ $ctx := $current }}
{{ if isset . "ctx" }}
  {{ $ctx = .ctx }}
{{ end }}
{{ $id := "language-select" }}
{{ if isset . "id" }}
  {{ $id = .id }}
{{ end }}
{{ $name := "languages" }}
{{ if isset . "name" }}
  {{ $name = .name }}
{{ end }}
<div class="lang-switcher">
  <select
    id="{{ $id }}"
    name="{{ $name }}"
    aria-label="Language"
    onchange="(function(sel){var v=sel.value;if(!v)return; if(/^[a-zA-Z][a-zA-Z0-9+.-]*:/.test(v))return; if(v.charAt(0)!=='/')return; if(!/^\/[0-9A-Za-z/_\-]*$/.test(v))return; window.location.href=v;})(this)"
  >
    {{ range $ctx.Site.Languages }}
      {{ $lang := . }}
      {{ $isActive := eq $lang.Lang $ctx.Site.Language.Lang }}
      {{ $href := "" }}
      {{ $targets := where $ctx.AllTranslations "Lang" $lang.Lang }}
      {{ if gt (len $targets) 0 }}
        {{ $href = (index $targets 0).RelPermalink }}
      {{ else }}
        {{ $homeAlts := where $ctx.Site.Home.AllTranslations "Lang" $lang.Lang }}
        {{ if gt (len $homeAlts) 0 }}
          {{ $href = (index $homeAlts 0).RelPermalink }}
        {{ else }}
          {{ if eq $lang.Lang $ctx.Site.Language.Lang }}
            {{ $href = $ctx.Site.Home.RelPermalink }}
          {{ else }}
            {{ $href = printf "/%s/" $lang.Lang }}
          {{ end }}
        {{ end }}
      {{ end }}
      <option
        value="{{ $href }}"
        hreflang="{{ $lang.Lang }}"
        {{ if $isActive }}selected{{ end }}
      >
        {{ $lang.LanguageName }}
      </option>
    {{ end }}
  </select>
</div>
